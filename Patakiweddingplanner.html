<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Pataki Wedding">
<title>Pataki Wedding Planner</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#FAF8F5;--bgAlt:#F3EDE4;--sage:#7C8C6E;--sageDk:#5F6D52;--sageLt:#A8B89A;--sagePale:#E8EDE3;
--tan:#C4AD8F;--tanLt:#E8DECE;--tanDk:#A8915F;--cream:#FFF9F0;--white:#FFFFFF;
--text:#3D3929;--textMid:#6B634F;--textLt:#9C9480;--border:#E8E0D4;
--red:#C4756A;--redBg:#FDF0EE;--green:#7C8C6E;--greenBg:#EEF2EB;--goldBg:#FBF6EF;
--pink:#D4849B;--pinkBg:#FDF0F4;--pinkLt:#F2DCE4}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-tap-highlight-color:transparent}
::-webkit-scrollbar{display:none}
input,select,button{font-family:inherit}
.hdr{background:var(--white);border-bottom:1px solid var(--border);padding:52px 20px 14px;position:sticky;top:0;z-index:50;text-align:center}
.hdr-sub{font-size:11px;font-weight:700;color:var(--sage);text-transform:uppercase;letter-spacing:3px}
.hdr-title{font-size:22px;font-weight:800;margin-top:-2px}
.hdr-names{font-size:12px;color:var(--textLt);margin-top:2px}
.tabs{display:flex;background:var(--white);border-bottom:1px solid var(--border);padding:0 2px;overflow-x:auto;position:sticky;top:88px;z-index:50}
.tb{flex:1;min-width:48px;padding:10px 2px 8px;border:none;border-bottom:3px solid transparent;background:transparent;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;transition:all .2s}
.tb.a{border-bottom-color:var(--sage)}
.tb .i{font-size:14px}
.tb .l{font-size:9px;font-weight:600;color:var(--textLt)}
.tb.a .l{color:var(--sage)}
/* FIXED: max-width needs px */
.ct{padding:16px 16px 120px;max-width:500px;margin:0 auto}
.cd{background:var(--white);border-radius:16px;padding:18px 20px;border:1px solid var(--border);margin-bottom:12px}
.inp{padding:12px 16px;border-radius:12px;border:1.5px solid var(--border);background:var(--white);color:var(--text);font-size:15px;outline:none;width:100%;transition:border .2s}
.inp:focus{border-color:var(--sage)}
.sel{padding:12px 16px;border-radius:12px;border:1.5px solid var(--border);background:var(--white);color:var(--text);font-size:15px;outline:none;width:100%;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236B634F' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px}
.sel option{background:var(--white);color:var(--text)}
.btn{padding:11px 22px;border-radius:12px;font-size:14px;font-weight:600;cursor:pointer;border:none;background:var(--sage);color:var(--white);transition:all .15s;width:100%}
.btn:active{opacity:.85;transform:scale(.98)}
.btn-g{background:var(--bgAlt);color:var(--textMid);border:1px solid var(--border)}
.btn-s{padding:4px 10px;font-size:11px;border-radius:8px;width:auto;background:none;border:1px solid var(--border);color:var(--textLt);cursor:pointer}
.btn-s.d{color:var(--red)}
.lbl{font-size:12px;font-weight:600;color:var(--textMid);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px}
.pill{padding:7px 14px;border-radius:20px;border:1px solid var(--border);background:var(--white);color:var(--textMid);font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap;transition:all .2s}
.pill.a{background:var(--sage);color:var(--white);border-color:var(--sage)}
.pill .c{background:var(--sagePale);border-radius:10px;padding:1px 7px;font-size:11px;font-weight:700;margin-left:4px}
.pill.a .c{background:rgba(255,255,255,.3)}
.chk{width:26px;height:26px;border-radius:50%;border:2px solid var(--border);background:transparent;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;color:transparent;font-size:13px;transition:all .2s}
.chk.dn{border-color:var(--sage);background:var(--sage);color:var(--white)}
.dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.av{width:40px;height:40px;border-radius:50%;background:var(--sagePale);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--sageDk);font-size:16px;flex-shrink:0}
.av.pk{background:var(--pinkLt);color:var(--pink)}
.mb{position:fixed;inset:0;z-index:100;display:flex;align-items:flex-end;justify-content:center}
.mo{position:absolute;inset:0;background:rgba(0,0,0,.3);backdrop-filter:blur(4px)}
.ms{position:relative;background:var(--bg);border-radius:24px 24px 0 0;width:100%;max-width:500px;max-height:85vh;overflow:auto;padding:8px 0 24px;animation:su .3s ease}
.mh{width:36px;height:4px;border-radius:2px;background:var(--border);margin:8px auto 16px}
.mx{background:var(--bgAlt);border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;color:var(--textMid)}
.pb{height:4px;border-radius:2px;background:var(--bgAlt)}
.pf{height:100%;border-radius:2px;transition:width .4s}
.sb{position:fixed;top:0;left:0;right:0;z-index:200;height:3px;background:var(--sage);animation:pu 1.5s infinite}
.hd{display:none}
@keyframes su{from{transform:translateY(100%)}to{transform:translateY(0)}}
@keyframes pu{0%,100%{opacity:.3}50%{opacity:1}}
</style>
</head>
<body>
<div id="si" class="sb hd"></div>
<div class="hdr"><div class="hdr-sub">The Pataki</div><div class="hdr-title">Wedding Planner</div><div class="hdr-names" id="hn"></div></div>
<div class="tabs" id="tabs"></div>
<div class="ct" id="ct"></div>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyBjNn9uMWSbyO3i8bFPbxKCSraHvxhdLbQ",authDomain:"pataki-wedding.firebaseapp.com",projectId:"pataki-wedding",storageBucket:"pataki-wedding.firebasestorage.app",messagingSenderId:"690547288662",appId:"1:690547288662:web:729348ea23813df2b5a9f7"});
const db=firebase.firestore(),DOC=db.collection("weddings").doc("pataki");

// PRELOADED WEDDING GUESTS
const PREGUESTS=[
{n:"Mom Hockenberry"},{n:"Dad Hockenberry"},{n:"Kaci Hockenberry"},{n:"Grandma Hockenberry"},{n:"Pop Hockenberry"},
{n:"Mom Racho"},{n:"Matt Racho"},{n:"Franklin Pataki"},{n:"Austin Pataki"},{n:"Jessica Cusatis"},
{n:"Lauren Pataki"},{n:"Noah Stauffer"},{n:"Olivia Racho"},{n:"Aaron Nowak"},{n:"Ian Racho"},
{n:"Grace Cram"},{n:"Grandmom Plesh"},{n:"Grandpop Plesh"},{n:"Aunt Mary"},{n:"Uncle Bob"},
{n:"Rob Tomko"},{n:"Holly Tomko"},{n:"Rosalie Tomko"},{n:"Amelia Tomko"},{n:"John Tomko"},
{n:"Carly Sweetra"},{n:"Brian Sweetra"},{n:"Jack Tomko"},{n:"Jessica Ulozas"},{n:"Aunt Liz"},
{n:"Uncle Jeff"},{n:"Rebecca Tomko",po:true},{n:"Aunt Jill"},{n:"Uncle Mike"},{n:"Taylor Dworak"},
{n:"Morgan Rex"},{n:"Blaine Rex"},{n:"Diane Hockenberry"},{n:"Uncle Lee"},{n:"Jake Hockenberry"},
{n:"Alexis Powell"},{n:"Jimmy Powell"},{n:"Aunt Jeannie"},{n:"Uncle Larry"},{n:"Maddison",po:true},
{n:"Alec",po:true},{n:"Aunt Rosie"},{n:"Uncle Vinny"},{n:"Julia Merante",po:true},{n:"Anna Merante"},
{n:"Danny Mot"},{n:"Aunt Elaine"},{n:"Emily Farrell"},{n:"Beaudyn Lewis"},{n:"Jade Monka"},
{n:"Steven Monka"},{n:"Travis Buckner"},{n:"Samantha Banyas"},{n:"Sophia Buckner"},{n:"Charlie Kishbaugh"},
{n:"Corky Hopkins"},{n:"John Hopkins"},{n:"Gene Shelly"},{n:"Patsy Shelly"},{n:"Jill Myers"},
{n:"Joanne Lushefski"},{n:"Chris Lushefski"},{n:"Lori Besecker"},{n:"Jeff Besecker"},{n:"Colleen Kubishin"},
{n:"Chris Kubishin"},{n:"Nick Kubishin",po:true},{n:"Alex Kubishin",po:true},{n:"Corey Joseph"},{n:"Brianna Joseph"},
{n:"Mario Jordan"},{n:"Tom Jordan"},{n:"Ann Organist"},{n:"Bonnie Racho"},{n:"Joe Racho"},
{n:"Maria Garrison"},{n:"Stephen Garrison"},{n:"Scott Luchi"},{n:"Jean Luchi"},{n:"Martin Heaney"},
{n:"Lee Bachman"},{n:"Ronald Bachman"},{n:"Andrea Bachman"},{n:"Jayne Taylor"},{n:"Megan Farrell"},
{n:"Jim Farrell"},{n:"Liam Farrell",po:true},{n:"James Farrell"},{n:"Arianna Lai",po:true},{n:"Mike Bendick"},
{n:"Jackie Bendick"},{n:"Abbie Konnick"},{n:"PJ Konnick"},{n:"Angela Bendick"},{n:"Christo Hunnington"},
{n:"Amelia Bendick"},{n:"Colene Jayne"},{n:"Sam Jayne"},{n:"Abby Jayne",po:true},{n:"Carol Hill"},
{n:"Harold Hill"},{n:"Maureen Hornlein"},{n:"John Hornlein"},{n:"Pete Kerdesky"},{n:"Michelle Caffery"},
{n:"Brandon Green"},{n:"Savana Green"},{n:"Chad Seltzer"},{n:"Mel Seltzer"},{n:"James Murray"},
{n:"Steph Murray"},{n:"Ryan Mazeika"},{n:"Lacy Mazeika"},{n:"Ben Sheehe"},{n:"Trish Sheehe"},
{n:"John Sheehe"},{n:"Maggie Dow"},{n:"Cliff Labour"},{n:"Janelle Holloman"},{n:"Joe Varano"},
{n:"Amy Varano"},{n:"Travis Potter"},{n:"Chelsea Potter"},{n:"Brandon Shoemaker"},{n:"Bethanne Shoemaker"},
{n:"Justin Mowery"},{n:"Kasey Mowery"},{n:"Jack Breisch"},{n:"Danielle Breisch"},{n:"Eric Tino",po:true},
{n:"Kimball Cushman"},{n:"Kelly Cushman"},{n:"Jim Hischar"},{n:"Cari Hischar"},{n:"CJ Stofka"},
{n:"Fabianny Gomez"},{n:"Charlie Karchner"},{n:"Tonnilynn Karchner"},{n:"Jon Fogarty",po:true},
{n:"LJ Sidari",po:true},{n:"Ricky Gil",po:true}
];

// PRELOADED BRIDAL SHOWER GUESTS (from your Excel)
const PRE_SHOWER_GUESTS=[
  {n:"Mom Hockenberry"},
  {n:"Kaci Hockenberry"},
  {n:"Mom Racho"},
  {n:"Lauren Pataki"},
  {n:"Jessica Cusatis"},
  {n:"Grandma Hockenberry"},
  {n:"Grandmom Plesh"},
  {n:"Aunt Mary"},
  {n:"Carly Sweetra"},
  {n:"Holly Tomko"},
  {n:"Rosalie Tomko"},
  {n:"Amelia Tomko"},
  {n:"Jill Myers"},
  {n:"Jessica Ulozas"},
  {n:"Aunt Liz"},
  {n:"Rebecca Tomko"},
  {n:"Aunt Jill"},
  {n:"Morgan Rex"},
  {n:"Taylor Dworak"},
  {n:"Emily Farrell"},
  {n:"Megan Farrell"},
  {n:"Jade Monka"},
  {n:"Aunt Corky"},
  {n:"Aunt Patsy"},
  {n:"Joanne Lushefski"},
  {n:"Abigail Lushefski"},
  {n:"Lori Besecker"},
  {n:"Kylee Besecker"},
  {n:"Aunt Rosie"},
  {n:"Julia Merante"},
  {n:"Anna Merante"},
  {n:"Aunt Jeanne"},
  {n:"Maddison Plesh"},
  {n:"Aunt Elaine"},
  {n:"Olivia Racho"},
  {n:"Sam Banyas"},
  {n:"Sophia Buckner"},
  {n:"Colleen Kubishin"},
  {n:"Brianna Joseph"},
  {n:"Bonnie Racho"},
  {n:"Grace Cram"},
  {n:"Angela Bendick"},
  {n:"Amelia Bendick"},
  {n:"Fabianny Gomez"},
  {n:"Abbie Konnick"},
  {n:"Jackie Bendick"},
  {n:"Arianna Lai"},
  {n:"Carey Hischar"},
  {n:"Kasey Mowery"},
  {n:"Danielle Breisch"},
  {n:"Bethanne Shoemaker"},
  {n:"Michelle Caffery"},
  {n:"Trish Sheehe"},
  {n:"Maggie Dow"},
  {n:"Janelle Holloman"},
  {n:"Amy Varano"},
  {n:"Chelsea Potter"},
  {n:"Stephanie Murray"},
  {n:"Diane Hockenberry"},
  {n:"Alexis Powell"},
  {n:"Stacie Lewis"},
  {n:"Nadine Hromisin"},
  {n:"Johyne Hoyes"},
  {n:"Debbie Bowling"},
  {n:"Christa Saitta"},
  {n:"Sue Jones"},
  {n:"Mel Kowalski"}
];

const TASK_CATS=[
{name:"12+ Months Out",icon:"üìã",tasks:[{t:"Set your overall budget",p:"high"},{t:"Choose your wedding date",p:"high"},{t:"Draft initial guest list",p:"high"},{t:"Research & book venue",p:"high"},{t:"Start researching vendors",p:"medium"},{t:"Choose wedding party",p:"medium"},{t:"Hire a wedding planner or coordinator",p:"low"}]},
{name:"9‚Äì12 Months Out",icon:"üì∏",tasks:[{t:"Book photographer & videographer",p:"high"},{t:"Book caterer or finalize venue catering",p:"high"},{t:"Hire DJ or band",p:"medium"},{t:"Book florist",p:"medium"},{t:"Book officiant",p:"high"},{t:"Start dress or suit shopping",p:"medium"},{t:"Create wedding website",p:"medium"},{t:"Send save-the-dates",p:"high"},{t:"Book hotel room blocks",p:"medium"}]},
{name:"6‚Äì9 Months Out",icon:"üíå",tasks:[{t:"Register for gifts",p:"medium"},{t:"Plan honeymoon",p:"low"},{t:"Book transportation",p:"low"},{t:"Schedule hair & makeup trial",p:"medium"},{t:"Order cake or desserts",p:"medium"},{t:"Plan rehearsal dinner",p:"medium"},{t:"Choose wedding party attire",p:"medium"}]},
{name:"3‚Äì6 Months Out",icon:"‚úâÔ∏è",tasks:[{t:"Send invitations",p:"high"},{t:"Order wedding bands",p:"high"},{t:"Finalize ceremony readings & vows",p:"medium"},{t:"Apply for marriage license",p:"high"},{t:"Plan welcome bags",p:"low"},{t:"Book rehearsal dinner venue",p:"medium"},{t:"Finalize d√©cor & rentals",p:"medium"}]},
{name:"1‚Äì3 Months Out",icon:"üé∂",tasks:[{t:"Finalize seating chart",p:"high"},{t:"Confirm all vendor details",p:"high"},{t:"Create day-of timeline",p:"high"},{t:"Break in wedding shoes",p:"low"},{t:"Write toasts or speeches",p:"medium"},{t:"Final fitting",p:"high"},{t:"Send rehearsal dinner invites",p:"medium"}]},
{name:"Final Weeks",icon:"üíç",tasks:[{t:"Confirm final guest count",p:"high"},{t:"Pick up marriage license",p:"high"},{t:"Prepare tips & payments for vendors",p:"high"},{t:"Pack for honeymoon",p:"low"},{t:"Rehearsal & rehearsal dinner",p:"high"},{t:"Delegate day-of tasks",p:"medium"},{t:"Relax and enjoy your day!",p:"low"}]}
];

const SHOWER_TASKS=[
{t:"Set shower budget",p:"high",done:false},{t:"Choose a date & time",p:"high",done:false},{t:"Book venue or decide on location",p:"high",done:false},
{t:"Choose a theme",p:"medium",done:false},{t:"Create guest list",p:"high",done:false},{t:"Send invitations",p:"high",done:false},
{t:"Plan menu & order food",p:"medium",done:false},{t:"Order cake or desserts",p:"medium",done:false},{t:"Plan games & activities",p:"medium",done:false},
{t:"Buy decorations",p:"medium",done:false},{t:"Arrange flowers",p:"low",done:false},{t:"Set up photo area",p:"low",done:false},
{t:"Buy party favors",p:"low",done:false},{t:"Confirm RSVPs",p:"high",done:false},{t:"Finalize day-of timeline",p:"medium",done:false}
];

const DEF_BUDGET=[
{id:1,cat:"Venue & Rentals",est:10000,act:0,paid:false},{id:2,cat:"Catering & Bar",est:7000,act:0,paid:false},
{id:3,cat:"Photography",est:3000,act:0,paid:false},{id:4,cat:"Videography",est:2000,act:0,paid:false},
{id:5,cat:"Flowers & D√©cor",est:2500,act:0,paid:false},{id:6,cat:"Music & Entertainment",est:1500,act:0,paid:false},
{id:7,cat:"Wedding Attire",est:2500,act:0,paid:false},{id:8,cat:"Cake & Desserts",est:600,act:0,paid:false},
{id:9,cat:"Stationery & Invites",est:500,act:0,paid:false},{id:10,cat:"Transportation",est:800,act:0,paid:false},
{id:11,cat:"Favors & Gifts",est:400,act:0,paid:false},{id:12,cat:"Hair & Makeup",est:600,act:0,paid:false},
{id:13,cat:"Officiant",est:300,act:0,paid:false},{id:14,cat:"Rings",est:1500,act:0,paid:false},
{id:15,cat:"Honeymoon",est:3000,act:0,paid:false},{id:16,cat:"Miscellaneous",est:1000,act:0,paid:false}
];

const DEF_TL=[
{id:1,time:"8:00 AM",event:"Hair & makeup begins",who:"Bridal Party",loc:"Bridal Suite"},
{id:2,time:"11:00 AM",event:"Photographer arrives",who:"Vendors",loc:"Venue"},
{id:3,time:"11:30 AM",event:"First look photos",who:"Couple",loc:"Garden"},
{id:4,time:"12:00 PM",event:"Wedding party photos",who:"Wedding Party",loc:"Garden"},
{id:5,time:"1:00 PM",event:"Family photos",who:"Family",loc:"Venue"},
{id:6,time:"2:00 PM",event:"Guests arrive",who:"Guests",loc:"Ceremony"},
{id:7,time:"2:30 PM",event:"Ceremony begins",who:"Everyone",loc:"Ceremony"},
{id:8,time:"3:00 PM",event:"Cocktail hour",who:"Guests",loc:"Patio"},
{id:9,time:"4:00 PM",event:"Grand entrance & dinner",who:"Everyone",loc:"Reception"},
{id:10,time:"5:00 PM",event:"First dance",who:"Couple",loc:"Reception"},
{id:11,time:"5:15 PM",event:"Parent dances",who:"Family",loc:"Reception"},
{id:12,time:"5:30 PM",event:"Toasts & speeches",who:"Wedding Party",loc:"Reception"},
{id:13,time:"6:00 PM",event:"Cake cutting",who:"Couple",loc:"Reception"},
{id:14,time:"6:30 PM",event:"Open dancing",who:"Everyone",loc:"Dance Floor"},
{id:15,time:"9:00 PM",event:"Last dance & send-off",who:"Everyone",loc:"Venue"}
];

function buildTasks(){let id=1;const t=[];TASK_CATS.forEach(c=>c.tasks.forEach(tk=>t.push({id:id++,text:tk.t,done:false,category:c.name,priority:tk.p})));return t;}
function buildGuests(){return PREGUESTS.map((g,i)=>({id:i+1,name:g.n,rsvp:"pending",meal:"Standard",plusOne:!!g.po,table:"",notes:"",type:"wedding"}));}
function buildShowerTasks(){return SHOWER_TASKS.map((t,i)=>({id:i+1,text:t.t,priority:t.p,done:false}));}
function buildShowerGuests(){return PRE_SHOWER_GUESTS.map((g,i)=>({id:i+1,name:g.n,rsvp:"pending"}));}

let S={p1:"",p2:"",wDate:"",tasks:[],budget:[],guests:[],tables:[{id:1,name:"Table 1",seats:10},{id:2,name:"Table 2",seats:10},{id:3,name:"Table 3",seats:8}],timeline:[],
showerDate:"",showerVenue:"",showerGuests:[],showerTasks:[],showerBudget:[{id:1,cat:"Venue",est:500,act:0},{id:2,cat:"Food & Drinks",est:400,act:0},{id:3,cat:"Cake",est:100,act:0},{id:4,cat:"Decorations",est:200,act:0},{id:5,cat:"Games & Prizes",est:100,act:0},{id:6,cat:"Favors",est:75,act:0},{id:7,cat:"Flowers",est:100,act:0},{id:8,cat:"Misc",est:100,act:0}]};
let tab="home",tf="all",gf="all",sf="all",sq="",modal=null,loaded=false;

let saveT=null;
function save(){clearTimeout(saveT);saveT=setTimeout(()=>{document.getElementById("si").classList.remove("hd");DOC.set(S).then(()=>document.getElementById("si").classList.add("hd")).catch(()=>document.getElementById("si").classList.add("hd"));},500);}

DOC.onSnapshot(doc=>{
  if(doc.exists){
    S={...S,...doc.data()};
    if(!loaded)loaded=true;
    render();
  }else if(!loaded){
    S.tasks=buildTasks();
    S.budget=DEF_BUDGET;
    S.timeline=DEF_TL;
    S.guests=buildGuests();
    S.showerTasks=buildShowerTasks();
    S.showerGuests=buildShowerGuests();   // <-- preload shower guests on first run
    loaded=true;
    save();
    render();
  }
},()=>{
  if(!loaded){
    S.tasks=buildTasks();
    S.budget=DEF_BUDGET;
    S.timeline=DEF_TL;
    S.guests=buildGuests();
    S.showerTasks=buildShowerTasks();
    S.showerGuests=buildShowerGuests();   // <-- preload shower guests on first run (fallback)
    loaded=true;
    render();
  }
});

function up(c){Object.assign(S,c);save();render();}

function h(t,a,...ch){const e=document.createElement(t);if(a)Object.entries(a).forEach(([k,v])=>{if(k==="style"&&typeof v==="object")Object.assign(e.style,v);else if(k.startsWith("on"))e[k.toLowerCase()]=v;else if(k==="cls")e.className=v;else if(k==="html")e.innerHTML=v;else e.setAttribute(k,v);});ch.flat().forEach(c=>{if(c!=null)e.appendChild(typeof c==="string"?document.createTextNode(c):c);});return e;}
function pc(p){return p==="high"?"var(--red)":p==="medium"?"var(--tan)":"var(--sageLt)";}
function ring(pct,sz,col){const r=(sz-6)/2,ci=2*Math.PI*r,o=ci-(pct/100)*ci;return`<svg width="${sz}" height="${sz}" style="transform:rotate(-90deg)"><circle cx="${sz/2}" cy="${sz/2}" r="${r}" fill="none" stroke="var(--border)" stroke-width="5"/><circle cx="${sz/2}" cy="${sz/2}" r="${r}" fill="none" stroke="${col}" stroke-width="5" stroke-dasharray="${ci}" stroke-dashoffset="${o}" stroke-linecap="round" style="transition:stroke-dashoffset .6s"/></svg>`;}
function dl(){if(!S.wDate)return null;return Math.max(0,Math.ceil((new Date(S.wDate+"T00:00:00")-new Date())/864e5));}
function sdl(){if(!S.showerDate)return null;return Math.max(0,Math.ceil((new Date(S.showerDate+"T00:00:00")-new Date())/864e5));}

// UPDATED: Shower tab icon is üçì, removed the extra "Shower List" tab
const TABS=[["home","üè†","Home"],["tasks","‚úì","Tasks"],["budget","$","Budget"],["guests","üë•","Guests"],["seating","‚óâ","Seating"],["timeline","üïê","Day Of"],["shower","üçì","Shower"]];

function render(){
  document.getElementById("hn").textContent=(S.p1&&S.p2)?S.p1+" & "+S.p2:"";
  const tb=document.getElementById("tabs");tb.innerHTML="";
  TABS.forEach(([id,ic,lb])=>{
    const b=h("button",{cls:`tb ${tab===id?"a":""}`,onClick:()=>{tab=id;sq="";render();}});
    b.innerHTML=`<span class="i">${ic}</span><span class="l">${lb}</span>`;
    tb.appendChild(b);
  });
  const ct=document.getElementById("ct");ct.innerHTML="";
  if(!loaded){ct.innerHTML=`<div style="text-align:center;padding:60px 20px;color:var(--textLt)"><div style="font-size:32px;margin-bottom:12px">üíç</div><div style="font-weight:600">Loading...</div></div>`;return;}
  if(tab==="home")rHome(ct);else if(tab==="tasks")rTasks(ct);else if(tab==="budget")rBudget(ct);else if(tab==="guests")rGuests(ct);else if(tab==="seating")rSeating(ct);else if(tab==="timeline")rTimeline(ct);else if(tab==="shower")rShower(ct);
}

// HOME
function rHome(ct){
const d=dl(),td=S.tasks.filter(t=>t.done).length,tp=S.tasks.length?Math.round(td/S.tasks.length*100):0;
const tE=S.budget.reduce((s,b)=>s+b.est,0),tA=S.budget.reduce((s,b)=>s+b.act,0),bp=tE?Math.min(100,Math.round(tA/tE*100)):0;
const wg=S.guests.filter(g=>g.type==="wedding"||!g.type);
const cn=wg.filter(g=>g.rsvp==="yes").reduce((s,g)=>s+(g.plusOne?2:1),0);
const pn=wg.filter(g=>g.rsvp==="pending").reduce((s,g)=>s+(g.plusOne?2:1),0);
const sd=sdl(),std=S.showerTasks.filter(t=>t.done).length;

let html=`<div class="cd" style="background:linear-gradient(135deg,var(--sagePale),var(--tanLt));border:none;text-align:center;padding:28px 24px">
<div style="font-size:13px;font-weight:600;color:var(--sage);text-transform:uppercase;letter-spacing:2px;margin-bottom:12px">The Pataki Wedding</div>
<div style="display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap;margin-bottom:8px">
<input class="inp" placeholder="Partner 1" value="${S.p1}" id="ip1" style="width:120px;text-align:center;font-weight:600;background:rgba(255,255,255,.7);font-size:16px">
<span style="font-size:22px">üíç</span>
<input class="inp" placeholder="Partner 2" value="${S.p2}" id="ip2" style="width:120px;text-align:center;font-weight:600;background:rgba(255,255,255,.7);font-size:16px">
</div>
<div style="display:flex;justify-content:center;margin-top:8px"><input type="date" class="inp" value="${S.wDate}" id="iwd" style="width:170px;text-align:center;background:rgba(255,255,255,.7)"></div>
${d!==null?`<div style="font-size:48px;font-weight:800;color:var(--sageDk);line-height:1;margin-top:16px">${d}</div><div style="font-size:14px;color:var(--textMid);font-weight:500">days until your wedding</div>`:""}
</div>`;

html+=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div class="cd" style="cursor:pointer" id="hs-tasks"><div style="display:flex;align-items:center;gap:12px">
<div style="position:relative">${ring(tp,56,"var(--sage)")}<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--sage)">${tp}%</div></div>
<div><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Tasks</div>
<div style="font-size:20px;font-weight:700">${td}<span style="font-size:14px;color:var(--textLt)">/${S.tasks.length}</span></div></div></div></div>
<div class="cd" style="cursor:pointer" id="hs-budget"><div style="display:flex;align-items:center;gap:12px">
<div style="position:relative">${ring(bp,56,tA>tE?"var(--red)":"var(--tan)")}<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:${tA>tE?"var(--red)":"var(--tan)"}">${bp}%</div></div>
<div><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Spent</div>
<div style="font-size:18px;font-weight:700">$${tA.toLocaleString()}</div>
<div style="font-size:11px;color:var(--textLt)">of $${tE.toLocaleString()}</div></div></div></div>
<div class="cd" style="cursor:pointer" id="hs-guests"><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Guests</div>
<div style="font-size:24px;font-weight:700;margin-top:2px">${cn} <span style="font-size:14px;color:var(--textLt)">confirmed</span></div>
<div style="display:flex;gap:8px;margin-top:6px"><span style="font-size:12px;color:var(--tan)">‚è≥ ${pn}</span></div></div>
<div class="cd" style="cursor:pointer" id="hs-shower"><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">üçì Shower</div>
<div style="font-size:20px;font-weight:700;margin-top:2px;color:var(--pink)">${std}<span style="font-size:14px;color:var(--textLt)">/${S.showerTasks.length}</span> tasks</div>
${sd!==null?`<div style="font-size:12px;color:var(--textLt);margin-top:2px">${sd} days away</div>`:""}</div></div>`;

const un=S.tasks.filter(t=>!t.done).sort((a,b)=>a.priority==="high"?-1:b.priority==="high"?1:0).slice(0,5);
if(un.length){html+=`<div class="cd"><div style="font-size:14px;font-weight:700;margin-bottom:14px">‚ö° Up Next</div>`;
un.forEach(t=>{html+=`<div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--bgAlt)" id="un-${t.id}">
<button class="chk" id="unc-${t.id}">‚úì</button>
<div style="flex:1"><div style="font-size:14px">${t.text}</div><div style="font-size:11px;color:var(--textLt)">${t.category}</div></div>
<div class="dot" style="background:${pc(t.priority)}"></div></div>`;});
html+=`</div>`;}

ct.innerHTML=html;
document.getElementById("ip1").addEventListener("change",e=>up({p1:e.target.value}));
document.getElementById("ip2").addEventListener("change",e=>up({p2:e.target.value}));
document.getElementById("iwd").addEventListener("change",e=>up({wDate:e.target.value}));
document.getElementById("hs-tasks").addEventListener("click",()=>{tab="tasks";render();});
document.getElementById("hs-budget").addEventListener("click",()=>{tab="budget";render();});
document.getElementById("hs-guests").addEventListener("click",()=>{tab="guests";render();});
document.getElementById("hs-shower").addEventListener("click",()=>{tab="shower";render();});
un.forEach(t=>{document.getElementById("unc-"+t.id).addEventListener("click",()=>{S.tasks=S.tasks.map(x=>x.id===t.id?{...x,done:!x.done}:x);up({tasks:S.tasks});});});
}

// TASKS
function rTasks(ct){
const td=S.tasks.filter(t=>t.done).length,todo=S.tasks.filter(t=>!t.done).length;
let html=`<input class="inp" placeholder="Search tasks..." value="${sq}" id="tsq" style="margin-bottom:12px">
<div style="display:flex;gap:6px;overflow-x:auto;padding-bottom:4px;margin-bottom:12px">
<button class="pill ${tf==="all"?"a":""}" id="tf-all">All<span class="c">${S.tasks.length}</span></button>
<button class="pill ${tf==="todo"?"a":""}" id="tf-todo">To Do<span class="c">${todo}</span></button>
<button class="pill ${tf==="done"?"a":""}" id="tf-done">Done<span class="c">${td}</span></button></div>`;

if(tf==="all"&&!sq){
html+=`<div class="cd" style="padding:14px 16px"><div style="font-size:13px;font-weight:700;margin-bottom:10px">Planning Timeline</div>`;
TASK_CATS.forEach(c=>{const ct2=S.tasks.filter(t=>t.category===c.name),dn=ct2.filter(t=>t.done).length,p=ct2.length?Math.round(dn/ct2.length*100):0;
html+=`<button class="phase-btn" id="ph-${c.name}" style="display:flex;align-items:center;gap:10px;padding:8px 0;width:100%;background:none;border:none;border-bottom:1px solid var(--bgAlt);cursor:pointer;text-align:left;font-family:inherit">
<span style="font-size:16px;width:24px">${c.icon}</span><div style="flex:1"><div style="font-size:13px;font-weight:600;color:var(--text)">${c.name}</div>
<div class="pb"><div class="pf" style="background:var(--sage);width:${p}%"></div></div></div>
<span style="font-size:12px;color:var(--textLt);font-weight:600">${dn}/${ct2.length}</span></button>`;});
html+=`</div>`;}else{
if(!["all","done","todo"].includes(tf))html+=`<button class="pill" id="tf-back" style="margin-bottom:12px">‚Üê All Phases</button>`;
let fl=tf==="all"?S.tasks:tf==="done"?S.tasks.filter(t=>t.done):tf==="todo"?S.tasks.filter(t=>!t.done):S.tasks.filter(t=>t.category===tf);
if(sq)fl=fl.filter(t=>t.text.toLowerCase().includes(sq.toLowerCase()));
fl.forEach(t=>{html+=`<div class="cd" style="padding:14px 16px;display:flex;align-items:center;gap:12px">
<button class="chk ${t.done?"dn":""}" id="tc-${t.id}">‚úì</button>
<div style="flex:1"><div style="font-size:14px;${t.done?"text-decoration:line-through;opacity:.5":""}">${t.text}</div>
<div style="font-size:11px;color:var(--textLt);margin-top:2px">${t.category}</div></div>
<div class="dot" style="background:${pc(t.priority)}"></div></div>`;});}

html+=`<button class="btn" style="margin-top:8px" id="tadd">+ Add Custom Task</button>`;
ct.innerHTML=html;
document.getElementById("tsq").addEventListener("input",e=>{sq=e.target.value;render();});
["all","todo","done"].forEach(f=>{const el=document.getElementById("tf-"+f);if(el)el.addEventListener("click",()=>{tf=f;render();});});
TASK_CATS.forEach(c=>{const el=document.getElementById("ph-"+c.name);if(el)el.addEventListener("click",()=>{tf=c.name;render();});});
const bb=document.getElementById("tf-back");if(bb)bb.addEventListener("click",()=>{tf="all";render();});
S.tasks.forEach(t=>{const el=document.getElementById("tc-"+t.id);if(el)el.addEventListener("click",()=>{S.tasks=S.tasks.map(x=>x.id===t.id?{...x,done:!x.done}:x);up({tasks:S.tasks});});});
document.getElementById("tadd").addEventListener("click",()=>{modal="addTask";rModal();});
}

// BUDGET
function rBudget(ct){
const tE=S.budget.reduce((s,b)=>s+b.est,0),tA=S.budget.reduce((s,b)=>s+b.act,0),bp=tE?Math.min(100,Math.round(tA/tE*100)):0;
let html=`<div class="cd" style="background:linear-gradient(135deg,var(--sagePale),var(--tanLt));border:none">
<div style="display:flex;justify-content:space-between"><div><div style="font-size:12px;color:var(--sageDk);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Total Budget</div>
<div style="font-size:28px;font-weight:800;color:var(--sageDk)">$${tE.toLocaleString()}</div></div>
<div style="text-align:right"><div style="font-size:12px;color:var(--sageDk);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Spent</div>
<div style="font-size:28px;font-weight:800;color:${tA>tE?"var(--red)":"var(--sageDk)"}">$${tA.toLocaleString()}</div></div></div>
<div style="height:8px;border-radius:4px;background:rgba(255,255,255,.5);margin-top:16px"><div style="height:100%;border-radius:4px;background:${tA>tE?"var(--red)":"var(--sage)"};width:${bp}%;transition:width .4s"></div></div>
<div style="font-size:13px;color:var(--sageDk);margin-top:8px;text-align:center;font-weight:500">$${Math.max(0,tE-tA).toLocaleString()} remaining</div></div>`;

S.budget.forEach(b=>{const p=b.est?Math.min(100,Math.round(b.act/b.est*100)):0;
html+=`<div class="cd" style="padding:14px 16px"><div style="display:flex;align-items:center;gap:12px">
<div style="flex:1"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:14px;font-weight:600">${b.cat}</span>
${b.paid?'<span style="font-size:10px;font-weight:700;color:var(--green);background:var(--greenBg);padding:2px 8px;border-radius:10px">PAID</span>':""}</div>
<div style="font-size:12px;color:var(--textLt);margin-top:2px">Budget: $${b.est.toLocaleString()}</div></div>
<span id="bv-${b.id}" style="background:${b.act>0?(b.act>b.est?"var(--redBg)":"var(--greenBg)"):"var(--bgAlt)"};border-radius:10px;padding:8px 14px;cursor:pointer;font-size:15px;font-weight:700;color:${b.act>b.est?"var(--red)":b.act>0?"var(--sageDk)":"var(--textLt)"}">$${b.act.toLocaleString()}</span></div>
<div class="pb" style="margin-top:10px"><div class="pf" style="background:${b.act>b.est?"var(--red)":"var(--sage)"};width:${p}%"></div></div>
<div style="display:flex;gap:6px;margin-top:8px"><button class="btn-s" id="bp-${b.id}">${b.paid?"Unmark paid":"Mark paid"}</button>
<button class="btn-s d" id="br-${b.id}">Remove</button></div></div>`;});
html+=`<button class="btn" style="margin-top:8px" id="badd">+ Add Category</button>`;
ct.innerHTML=html;
S.budget.forEach(b=>{
document.getElementById("bv-"+b.id).addEventListener("click",()=>{const v=prompt("Enter actual cost for "+b.cat+":",b.act);if(v!==null){S.budget=S.budget.map(x=>x.id===b.id?{...x,act:Number(v)||0}:x);up({budget:S.budget});}});
document.getElementById("bp-"+b.id).addEventListener("click",()=>{S.budget=S.budget.map(x=>x.id===b.id?{...x,paid:!x.paid}:x);up({budget:S.budget});});
document.getElementById("br-"+b.id).addEventListener("click",()=>{S.budget=S.budget.filter(x=>x.id!==b.id);up({budget:S.budget});});
});
document.getElementById("badd").addEventListener("click",()=>{modal="addBudget";rModal();});
}

// GUESTS
function rGuests(ct){
const wg=S.guests.filter(g=>g.type==="wedding"||!g.type);
const cn=wg.filter(g=>g.rsvp==="yes").reduce((s,g)=>s+(g.plusOne?2:1),0);
const pn=wg.filter(g=>g.rsvp==="pending").reduce((s,g)=>s+(g.plusOne?2:1),0);
const dc=wg.filter(g=>g.rsvp==="no").reduce((s,g)=>s+(g.plusOne?2:1),0);
const tot=wg.reduce((s,g)=>s+(g.plusOne?2:1),0);

let html=`<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:12px">
<div class="cd" style="text-align:center;padding:14px;background:var(--greenBg);border-color:var(--sageLt)"><div style="font-size:22px;font-weight:800;color:var(--sage)">${cn}</div><div style="font-size:11px;color:var(--sageDk);font-weight:600">Confirmed</div></div>
<div class="cd" style="text-align:center;padding:14px;background:var(--goldBg);border-color:var(--tanLt)"><div style="font-size:22px;font-weight:800;color:var(--tanDk)">${pn}</div><div style="font-size:11px;color:var(--tanDk);font-weight:600">Pending</div></div>
<div class="cd" style="text-align:center;padding:14px;background:var(--redBg);border-color:#E8C4BF"><div style="font-size:22px;font-weight:800;color:var(--red)">${dc}</div><div style="font-size:11px;color:var(--red);font-weight:600">Declined</div></div></div>
<div style="font-size:13px;color:var(--textMid);text-align:center;margin-bottom:12px;font-weight:500">Total headcount: <strong>${tot}</strong> (including plus-ones) + 4 kids</div>
<input class="inp" placeholder="Search guests..." value="${sq}" id="gsq" style="margin-bottom:12px">
<div style="display:flex;gap:6px;overflow-x:auto;margin-bottom:12px">
<button class="pill ${gf==="all"?"a":""}" id="gf-all">All<span class="c">${tot}</span></button>
<button class="pill ${gf==="yes"?"a":""}" id="gf-yes">Confirmed</button>
<button class="pill ${gf==="pending"?"a":""}" id="gf-pending">Pending</button>
<button class="pill ${gf==="no"?"a":""}" id="gf-no">Declined</button></div>`;

let fl=gf==="all"?wg:wg.filter(g=>g.rsvp===gf);
if(sq)fl=fl.filter(g=>g.name.toLowerCase().includes(sq.toLowerCase()));

fl.forEach(g=>{html+=`<div class="cd" style="padding:14px 16px"><div style="display:flex;align-items:center;gap:12px">
<div class="av">${g.name.charAt(0).toUpperCase()}</div>
<div style="flex:1"><div style="font-weight:600;font-size:14px">${g.name}</div>
<div style="font-size:12px;color:var(--textLt);margin-top:1px">${g.plusOne?"+1":"Solo"} ¬∑ ${g.meal||"Standard"}${g.table?" ¬∑ "+g.table:""}</div></div>
<select class="sel" id="gr-${g.id}" style="width:auto;padding:6px 30px 6px 10px;font-size:12px;font-weight:600;border-color:${g.rsvp==="yes"?"var(--sage)":g.rsvp==="no"?"var(--red)":"var(--tan)"};color:${g.rsvp==="yes"?"var(--sage)":g.rsvp==="no"?"var(--red)":"var(--tanDk)"}">
<option value="pending" ${g.rsvp==="pending"?"selected":""}>Pending</option><option value="yes" ${g.rsvp==="yes"?"selected":""}>Confirmed</option><option value="no" ${g.rsvp==="no"?"selected":""}>Declined</option></select></div>
<div style="display:flex;gap:6px;margin-top:8px"><button class="btn-s d" id="gx-${g.id}">Remove</button></div></div>`;});

html+=`<button class="btn" style="margin-top:8px" id="gadd">+ Add Guest</button>`;
ct.innerHTML=html;
document.getElementById("gsq").addEventListener("input",e=>{sq=e.target.value;render();});
["all","yes","pending","no"].forEach(f=>{document.getElementById("gf-"+f).addEventListener("click",()=>{gf=f;render();});});
fl.forEach(g=>{
document.getElementById("gr-"+g.id).addEventListener("change",e=>{S.guests=S.guests.map(x=>x.id===g.id?{...x,rsvp:e.target.value}:x);up({guests:S.guests});});
document.getElementById("gx-"+g.id).addEventListener("click",()=>{S.guests=S.guests.filter(x=>x.id!==g.id);up({guests:S.guests});});
});
document.getElementById("gadd").addEventListener("click",()=>{modal="addGuest";rModal();});
}

// SEATING
function rSeating(ct){
const wg=S.guests.filter(g=>(g.type==="wedding"||!g.type)&&g.rsvp!=="no");
const asgn=wg.filter(g=>g.table);const unasgn=wg.filter(g=>!g.table);
let html=`<div class="cd" style="background:var(--sagePale);border:none;padding:16px"><div style="font-size:13px;font-weight:600;color:var(--sageDk)">${asgn.length} seated ¬∑ ${unasgn.length} unassigned</div></div>`;

S.tables.forEach(tbl=>{const seated=wg.filter(g=>g.table===tbl.name);const p=tbl.seats?Math.min(100,Math.round(seated.length/tbl.seats*100)):0;
html+=`<div class="cd"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
<div><span style="font-weight:700;font-size:15px">${tbl.name}</span><span style="font-size:12px;color:var(--textLt);margin-left:8px">${seated.length}/${tbl.seats}</span></div>
<button class="btn-s" id="tr-${tbl.id}">‚úï</button></div>
<div class="pb" style="margin-bottom:10px;margin-top:0"><div class="pf" style="background:${seated.length>tbl.seats?"var(--red)":"var(--sage)"};width:${p}%"></div></div>`;
seated.forEach(g=>{html+=`<div style="display:flex;align-items:center;gap:8px;padding:6px 0;font-size:13px"><div style="width:6px;height:6px;border-radius:50%;background:var(--sage)"></div>${g.name}<button class="btn-s" style="margin-left:auto" id="us-${g.id}">unseat</button></div>`;});
if(!seated.length)html+=`<div style="font-size:12px;color:var(--textLt);font-style:italic">Empty</div>`;
html+=`</div>`;});

html+=`<button class="btn" style="background:var(--sagePale);color:var(--sageDk);margin-top:4px" id="tabl-add">+ Add Table</button>`;

if(unasgn.length){html+=`<div class="cd" style="margin-top:4px"><div style="font-size:14px;font-weight:700;margin-bottom:10px">Unassigned (${unasgn.length})</div>`;
unasgn.forEach(g=>{html+=`<div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--bgAlt)">
<span style="font-size:13px;flex:1">${g.name}</span>
<select class="sel" id="as-${g.id}" style="width:auto;padding:4px 28px 4px 8px;font-size:12px"><option value="">Assign...</option>${S.tables.map(t=>`<option value="${t.name}">${t.name}</option>`).join("")}</select></div>`;});
html+=`</div>`;}

ct.innerHTML=html;
S.tables.forEach(tbl=>{document.getElementById("tr-"+tbl.id).addEventListener("click",()=>{S.guests=S.guests.map(g=>g.table===tbl.name?{...g,table:""}:g);S.tables=S.tables.filter(t=>t.id!==tbl.id);up({tables:S.tables,guests:S.guests});});});
wg.filter(g=>g.table).forEach(g=>{const el=document.getElementById("us-"+g.id);if(el)el.addEventListener("click",()=>{S.guests=S.guests.map(x=>x.id===g.id?{...x,table:""}:x);up({guests:S.guests});});});
unasgn.forEach(g=>{document.getElementById("as-"+g.id).addEventListener("change",e=>{if(e.target.value){S.guests=S.guests.map(x=>x.id===g.id?{...x,table:e.target.value}:x);up({guests:S.guests});}});});
document.getElementById("tabl-add").addEventListener("click",()=>{S.tables=[...S.tables,{id:Date.now(),name:"Table "+(S.tables.length+1),seats:10}];up({tables:S.tables});});
}

// TIMELINE
function rTimeline(ct){
let html=`<div class="cd" style="background:var(--sagePale);border:none;padding:16px;margin-bottom:16px"><div style="font-size:14px;font-weight:700;color:var(--sageDk)">Day-of Schedule</div>
<div style="font-size:12px;color:var(--textMid);margin-top:2px">Share with your wedding party & vendors</div></div>
<div style="position:relative;padding-left:32px"><div style="position:absolute;left:11px;top:12px;bottom:12px;width:2px;background:var(--sageLt)"></div>`;
S.timeline.forEach(t=>{html+=`<div style="position:relative;margin-bottom:12px">
<div style="position:absolute;left:-27px;top:18px;width:14px;height:14px;border-radius:50%;background:var(--white);border:3px solid var(--sage)"></div>
<div class="cd" style="padding:14px 16px"><div style="display:flex;justify-content:space-between;align-items:flex-start"><div>
<div style="font-size:12px;font-weight:700;color:var(--sage)">${t.time}</div>
<div style="font-size:15px;font-weight:600;margin-top:2px">${t.event}</div>
<div style="font-size:12px;color:var(--textLt);margin-top:2px">${t.who} ¬∑ ${t.loc}</div></div>
<button class="btn-s" id="tlr-${t.id}">‚úï</button></div></div></div>`;});
html+=`</div><button class="btn" style="margin-top:8px" id="tladd">+ Add Event</button>`;
ct.innerHTML=html;
S.timeline.forEach(t=>{document.getElementById("tlr-"+t.id).addEventListener("click",()=>{S.timeline=S.timeline.filter(x=>x.id!==t.id);up({timeline:S.timeline});});});
document.getElementById("tladd").addEventListener("click",()=>{modal="addTimeline";rModal();});
}

// SHOWER
function rShower(ct){
const sd=sdl();
const std=S.showerTasks.filter(t=>t.done).length,stp=S.showerTasks.length?Math.round(std/S.showerTasks.length*100):0;
const sg=S.showerGuests||[];
const scn=sg.filter(g=>g.rsvp==="yes").length,spn=sg.filter(g=>g.rsvp==="pending").length;
const stE=S.showerBudget.reduce((s,b)=>s+b.est,0),stA=S.showerBudget.reduce((s,b)=>s+b.act,0);
const [stab,setStab]=[window._stab||"overview",v=>{window._stab=v;render();}];

let html=`<div class="cd" style="background:linear-gradient(135deg,var(--pinkLt),var(--tanLt));border:none;text-align:center;padding:24px">
<div style="font-size:13px;font-weight:600;color:var(--pink);text-transform:uppercase;letter-spacing:2px;margin-bottom:8px">üéÄ Bridal Shower</div>
<div style="display:flex;justify-content:center;gap:8px;margin-bottom:8px">
<input class="inp" type="date" value="${S.showerDate||""}" id="sdt" style="width:170px;text-align:center;background:rgba(255,255,255,.7)">
</div>
<input class="inp" placeholder="Venue / Location" value="${S.showerVenue||""}" id="svn" style="text-align:center;background:rgba(255,255,255,.7);margin-top:4px">
${sd!==null?`<div style="font-size:36px;font-weight:800;color:var(--pink);line-height:1;margin-top:14px">${sd}</div><div style="font-size:13px;color:var(--textMid)">days away</div>`:""}
</div>`;

// Sub-tabs
html+=`<div style="display:flex;gap:6px;margin-bottom:12px;overflow-x:auto">
<button class="pill ${stab==="overview"?"a":""}" id="st-overview">Overview</button>
<button class="pill ${stab==="tasks"?"a":""}" id="st-tasks">Tasks</button>
<button class="pill ${stab==="guests"?"a":""}" id="st-guests">Guests<span class="c">${sg.length}</span></button>
<button class="pill ${stab==="budget"?"a":""}" id="st-budget">Budget</button></div>`;

if(stab==="overview"){
html+=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div class="cd"><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Tasks</div>
<div style="font-size:20px;font-weight:700;margin-top:4px">${std}<span style="font-size:14px;color:var(--textLt)">/${S.showerTasks.length}</span></div>
<div class="pb" style="margin-top:8px"><div class="pf" style="background:var(--pink);width:${stp}%"></div></div></div>
<div class="cd"><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Guests</div>
<div style="font-size:20px;font-weight:700;margin-top:4px">${scn} <span style="font-size:12px;color:var(--textLt)">confirmed</span></div>
<div style="font-size:12px;color:var(--tan);margin-top:4px">‚è≥ ${spn} pending</div></div>
<div class="cd"><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Budget</div>
<div style="font-size:18px;font-weight:700;margin-top:4px">$${stA.toLocaleString()}</div>
<div style="font-size:11px;color:var(--textLt)">of $${stE.toLocaleString()}</div></div>
<div class="cd"><div style="font-size:12px;color:var(--textLt);font-weight:600;text-transform:uppercase;letter-spacing:.5px">Remaining</div>
<div style="font-size:18px;font-weight:700;margin-top:4px;color:var(--sage)">$${Math.max(0,stE-stA).toLocaleString()}</div></div></div>`;
}

if(stab==="tasks"){
S.showerTasks.forEach(t=>{html+=`<div class="cd" style="padding:14px 16px;display:flex;align-items:center;gap:12px">
<button class="chk ${t.done?"dn":""}" id="sc-${t.id}">‚úì</button>
<div style="flex:1;font-size:14px;${t.done?"text-decoration:line-through;opacity:.5":""}">${t.text}</div>
<div class="dot" style="background:${pc(t.priority)}"></div></div>`;});
html+=`<button class="btn" style="margin-top:8px;background:var(--pink)" id="stadd">+ Add Task</button>`;
}

if(stab==="guests"){
const sfl=sf==="all"?sg:sg.filter(g=>g.rsvp===sf);
html+=`<div style="display:flex;gap:6px;margin-bottom:12px">
<button class="pill ${sf==="all"?"a":""}" id="sf-all">All</button>
<button class="pill ${sf==="yes"?"a":""}" id="sf-yes">Confirmed</button>
<button class="pill ${sf==="pending"?"a":""}" id="sf-pending">Pending</button></div>`;
if(!sfl.length&&!sg.length){html+=`<div class="cd" style="text-align:center;padding:30px;color:var(--textLt)"><div style="font-size:24px;margin-bottom:8px">üéÄ</div>No shower guests yet.</div>`;}
sfl.forEach(g=>{html+=`<div class="cd" style="padding:12px 16px;display:flex;align-items:center;gap:12px">
<div class="av pk">${g.name.charAt(0).toUpperCase()}</div>
<div style="flex:1"><div style="font-weight:600;font-size:14px">${g.name}</div></div>
<select class="sel" id="sr-${g.id}" style="width:auto;padding:6px 30px 6px 10px;font-size:12px;font-weight:600;border-color:${g.rsvp==="yes"?"var(--sage)":"var(--tan)"};color:${g.rsvp==="yes"?"var(--sage)":"var(--tanDk)"}">
<option value="pending" ${g.rsvp==="pending"?"selected":""}>Pending</option><option value="yes" ${g.rsvp==="yes"?"selected":""}>Confirmed</option><option value="no" ${g.rsvp==="no"?"selected":""}>Declined</option></select>
<button class="btn-s d" id="sx-${g.id}">‚úï</button></div>`;});
html+=`<button class="btn" style="margin-top:8px;background:var(--pink)" id="sgadd">+ Add Guest</button>`;
}

if(stab==="budget"){
S.showerBudget.forEach(b=>{html+=`<div class="cd" style="padding:14px 16px"><div style="display:flex;align-items:center;gap:12px">
<div style="flex:1"><span style="font-size:14px;font-weight:600">${b.cat}</span>
<div style="font-size:12px;color:var(--textLt);margin-top:2px">Est: $${b.est.toLocaleString()}</div></div>
<span id="sbv-${b.id}" style="background:${b.act>0?"var(--pinkBg)":"var(--bgAlt)"};border-radius:10px;padding:8px 14px;cursor:pointer;font-size:15px;font-weight:700;color:${b.act>0?"var(--pink)":"var(--textLt)"}">$${b.act.toLocaleString()}</span></div></div>`;});
html+=`<button class="btn" style="margin-top:8px;background:var(--pink)" id="sbadd">+ Add Category</button>`;
}

ct.innerHTML=html;
document.getElementById("sdt").addEventListener("change",e=>up({showerDate:e.target.value}));
document.getElementById("svn").addEventListener("change",e=>up({showerVenue:e.target.value}));
["overview","tasks","guests","budget"].forEach(t=>{document.getElementById("st-"+t).addEventListener("click",()=>setStab(t));});

if(stab==="tasks"){
S.showerTasks.forEach(t=>{document.getElementById("sc-"+t.id).addEventListener("click",()=>{S.showerTasks=S.showerTasks.map(x=>x.id===t.id?{...x,done:!x.done}:x);up({showerTasks:S.showerTasks});});});
document.getElementById("stadd").addEventListener("click",()=>{modal="addShowerTask";rModal();});
}
if(stab==="guests"){
["all","yes","pending"].forEach(f=>{const el=document.getElementById("sf-"+f);if(el)el.addEventListener("click",()=>{sf=f;render();});});
sg.forEach(g=>{
const el=document.getElementById("sr-"+g.id);if(el)el.addEventListener("change",e=>{S.showerGuests=S.showerGuests.map(x=>x.id===g.id?{...x,rsvp:e.target.value}:x);up({showerGuests:S.showerGuests});});
const xb=document.getElementById("sx-"+g.id);if(xb)xb.addEventListener("click",()=>{S.showerGuests=S.showerGuests.filter(x=>x.id!==g.id);up({showerGuests:S.showerGuests});});
});
document.getElementById("sgadd").addEventListener("click",()=>{modal="addShowerGuest";rModal();});
}
if(stab==="budget"){
S.showerBudget.forEach(b=>{document.getElementById("sbv-"+b.id).addEventListener("click",()=>{const v=prompt("Enter actual cost for "+b.cat+":",b.act);if(v!==null){S.showerBudget=S.showerBudget.map(x=>x.id===b.id?{...x,act:Number(v)||0}:x);up({showerBudget:S.showerBudget});}});});
document.getElementById("sbadd").addEventListener("click",()=>{modal="addShowerBudget";rModal();});
}
}

// MODALS
function rModal(){
let ex=document.getElementById("mc");if(ex)ex.remove();if(!modal)return;
const bg=h("div",{id:"mc",cls:"mb",onClick:()=>{modal=null;rModal();}});
const ov=h("div",{cls:"mo"});
const sh=h("div",{cls:"ms",onClick:e=>e.stopPropagation()});
const hd=h("div",{cls:"mh"});
const pd=h("div",{style:{padding:"0 24px"}});
sh.append(hd,pd);bg.append(ov,sh);

const modals={
addGuest:{title:"Add Guest",html:`<div style="display:flex;flex-direction:column;gap:14px">
<div><div class="lbl">Name</div><input class="inp" id="mn" placeholder="Guest name"></div>
<div style="display:flex;gap:10px"><div style="flex:1"><div class="lbl">RSVP</div><select class="sel" id="mr"><option value="pending">Pending</option><option value="yes">Confirmed</option><option value="no">Declined</option></select></div>
<div style="flex:1"><div class="lbl">Meal</div><select class="sel" id="mm"><option>Standard</option><option>Vegetarian</option><option>Vegan</option><option>Gluten-Free</option><option>Kids Meal</option></select></div></div>
<div style="display:flex;gap:10px"><div style="flex:1"><div class="lbl">Table</div><select class="sel" id="mt"><option value="">Unassigned</option>${S.tables.map(t=>`<option value="${t.name}">${t.name}</option>`).join("")}</select></div>
<div style="flex:1"><div class="lbl">Plus One?</div><button class="btn btn-g" id="mp" style="width:100%">No</button></div></div>
<button class="btn" id="msub">Add Guest</button></div>`,
init:()=>{let po=false;document.getElementById("mp").addEventListener("click",()=>{po=!po;document.getElementById("mp").textContent=po?"Yes ‚úì":"No";document.getElementById("mp").style.background=po?"var(--sagePale)":"";});
document.getElementById("msub").addEventListener("click",()=>{const n=document.getElementById("mn").value.trim();if(!n)return;S.guests.push({id:Date.now(),name:n,rsvp:document.getElementById("mr").value,meal:document.getElementById("mm").value,plusOne:po,table:document.getElementById("mt").value,notes:"",type:"wedding"});up({guests:S.guests});modal=null;rModal();});}},

addTask:{title:"Add Task",html:`<div style="display:flex;flex-direction:column;gap:14px">
<div><div class="lbl">Task</div><input class="inp" id="mtt" placeholder="What needs to be done?"></div>
<div style="display:flex;gap:10px"><div style="flex:1"><div class="lbl">Phase</div><select class="sel" id="mtc">${TASK_CATS.map(c=>`<option>${c.name}</option>`).join("")}</select></div>
<div style="flex:1"><div class="lbl">Priority</div><select class="sel" id="mtp"><option value="high">üî¥ High</option><option value="medium" selected>üü° Medium</option><option value="low">üü¢ Low</option></select></div></div>
<button class="btn" id="msub">Add Task</button></div>`,
init:()=>{document.getElementById("msub").addEventListener("click",()=>{const t=document.getElementById("mtt").value.trim();if(!t)return;S.tasks.push({id:Date.now(),text:t,done:false,category:document.getElementById("mtc").value,priority:document.getElementById("mtp").value});up({tasks:S.tasks});modal=null;rModal();});}},

addBudget:{title:"Add Budget Category",html:`<div style="display:flex;flex-direction:column;gap:14px">
<div><div class="lbl">Category</div><input class="inp" id="mbc" placeholder="e.g. Photo Booth"></div>
<div><div class="lbl">Estimated Cost</div><input class="inp" type="number" id="mbe" placeholder="0"></div>
<button class="btn" id="msub">Add Category</button></div>`,
init:()=>{document.getElementById("msub").addEventListener("click",()=>{const c=document.getElementById("mbc").value.trim();if(!c)return;S.budget.push({id:Date.now(),cat:c,est:Number(document.getElementById("mbe").value)||0,act:0,paid:false});up({budget:S.budget});modal=null;rModal();});}},

addTimeline:{title:"Add Timeline Event",html:`<div style="display:flex;flex-direction:column;gap:14px">
<div><div class="lbl">Time</div><input class="inp" type="time" id="mlt"></div>
<div><div class="lbl">Event</div><input class="inp" id="mle" placeholder="What's happening?"></div>
<div style="display:flex;gap:10px"><div style="flex:1"><div class="lbl">Who</div><select class="sel" id="mlw"><option>Everyone</option><option>Couple</option><option>Bridal Party</option><option>Wedding Party</option><option>Family</option><option>Guests</option><option>Vendors</option></select></div>
<div style="flex:1"><div class="lbl">Location</div><input class="inp" id="mll" placeholder="Where?"></div></div>
<button class="btn" id="msub">Add Event</button></div>`,
init:()=>{document.getElementById("msub").addEventListener("click",()=>{const ev=document.getElementById("mle").value.trim();if(!ev)return;const tv=document.getElementById("mlt").value;const fm=tv?new Date("2000-01-01T"+tv).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):"TBD";S.timeline.push({id:Date.now(),time:fm,event:ev,who:document.getElementById("mlw").value,loc:document.getElementById("mll").value});S.timeline.sort((a,b)=>{const m=s=>{const x=s.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!x)return 9999;let h=+x[1];if(x[3].toUpperCase()==="PM"&&h!==12)h+=12;if(x[3].toUpperCase()==="AM"&&h===12)h=0;return h*60+ +x[2];};return m(a.time)-m(b.time);});up({timeline:S.timeline});modal=null;rModal();});}},

addShowerGuest:{title:"Add Shower Guest",html:`<div style="display:flex;flex-direction:column;gap:14px">
<div><div class="lbl">Name</div><input class="inp" id="msn" placeholder="Guest name"></div>
<div><div class="lbl">RSVP</div><select class="sel" id="msr"><option value="pending">Pending</option><option value="yes">Confirmed</option><option value="no">Declined</option></select></div>
<button class="btn" style="background:var(--pink)" id="msub">Add Guest</button></div>`,
init:()=>{document.getElementById("msub").addEventListener("click",()=>{const n=document.getElementById("msn").value.trim();if(!n)return;if(!S.showerGuests)S.showerGuests=[];S.showerGuests.push({id:Date.now(),name:n,rsvp:document.getElementById("msr").value});up({showerGuests:S.showerGuests});modal=null;rModal();});}},

addShowerTask:{title:"Add Shower Task",html:`<div style="display:flex;flex-direction:column;gap:14px">
<div><div class="lbl">Task</div><input class="inp" id="mst" placeholder="What needs to be done?"></div>
<div><div class="lbl">Priority</div><select class="sel" id="msp"><option value="high">üî¥ High</option><option value="medium" selected>üü° Medium</option><option value="low">üü¢ Low</option></select></div>
<button class="btn" style="background:var(--pink)" id="msub">Add Task</button></div>`,
init:()=>{document.getElementById("msub").addEventListener("click",()=>{const t=document.getElementById("mst").value.trim();if(!t)return;S.showerTasks.push({id:Date.now(),text:t,priority:document.getElementById("msp").value,done:false});up({showerTasks:S.showerTasks});modal=null;rModal();});}},

addShowerBudget:{title:"Add Shower Budget",html:`<div style="display:flex;flex-direction:column;gap:14px">
<div><div class="lbl">Category</div><input class="inp" id="msbc" placeholder="e.g. Decorations"></div>
<div><div class="lbl">Estimated Cost</div><input class="inp" type="number" id="msbe" placeholder="0"></div>
<button class="btn" style="background:var(--pink)" id="msub">Add Category</button></div>`,
init:()=>{document.getElementById("msub").addEventListener("click",()=>{const c=document.getElementById("msbc").value.trim();if(!c)return;S.showerBudget.push({id:Date.now(),cat:c,est:Number(document.getElementById("msbe").value)||0,act:0});up({showerBudget:S.showerBudget});modal=null;rModal();});}}
};

const m=modals[modal];if(!m)return;
pd.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
<h3 style="font-size:20px;font-weight:700">${m.title}</h3><button class="mx" id="mcl">‚úï</button></div>${m.html}`;
document.body.appendChild(bg);
document.getElementById("mcl").addEventListener("click",()=>{modal=null;rModal();});
m.init();
}

window._stab="overview";
</script>
</body>
</html>
